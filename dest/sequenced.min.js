var CanvasHelper,DefinationParser,Sequenced;Sequenced=function(){function e(){}var t,n,r,i,o,a,l,s,c,u,f,d,h,v,b,g,w,m,T,x,p,S,P,j,C,D,y,I,O;return b=null,y=null,D=null,S=null,p=null,P=null,h=null,O=null,v=null,r="#c0c0c0",t="#80aada",n="#f7ab42",i=800,c=100,s=40,a="Arial",o="#000",l=12,f=100,d=48,u=10,e.COLOR_OBJECT=["#fdd9b4","#bae0ec","#c2e2c7","#e5cff4","#c9d1f7","#f8cdd4"],e.renderAll=function(){var e,t,n,r;for(e=document.getElementsByTagName("canvas"),r=[],t=0,n=e.length;n>t;t++)h=e[t],r.push(h.hasAttribute("sequenced")?I(h):void 0);return r},e.render=function(e){return h=document.getElementById(e),I(h)},e.setObjectSize=function(e,t){return y=e,D=t},e.setFontFamily=function(e){return S=e},e.setFontColor=function(e){return p=e},e.setFontSize=function(e){return P=e},I=function(e){return O=DefinationParser.getSequenceData(e),C(),j(),x(),m()},j=function(){var e,t,n,r,o;return v=D+d*(O.maxRow+2/3-.5),o=parseInt(h.width),e=(v+2*u)/i*o,r=2*o,n=2*e,t=r/i,h.style.width=o+"px",h.style.height=e+"px",h.width=r,h.height=n,b=h.getContext("2d"),b.scale(t,t)},C=function(){return null===y&&(y=c),null===D&&(D=s),null===S&&(S=a),null===p&&(p=o),null===P?P=l:void 0},x=function(){var e,t,n,r,o,a;e=0,a=[];for(n in O.objects)r=u+(i-y-2*u)/(O.objectCount-1)*e++,o=u,t=O.objects[n],a.push(T(r,o,y,D,n,t));return a},T=function(n,i,o,a,l,s){var c;return c=function(t){var n;return n=t>5?t-6:t,e.COLOR_OBJECT[n]},CanvasHelper.drawLifeline(b,n+y/2,i+D,d*O.maxRow,"#fff",t),g(n,i,s),CanvasHelper.drawRoundedRect(b,n,i,o,a,c(s.id),r,5),CanvasHelper.drawWrapText(b,l,n+y/2,i+D/2+P/3,y-10,"bold",P,p,S)},g=function(e,n,r){var i,o,a,l,s,c,f;for(c=r.activations,f=[],l=0,s=c.length;s>l;l++)i=c[l],a=1===i?u+D:u+D+d*(i-5/6),o=1===i?d*(1+1/6):d,f.push(CanvasHelper.drawActivation(b,e+y/2,a,o,d*O.maxRow,"#fff",t));return f},m=function(){var e,t,n,r,i;for(r=O.messages,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(w(e));return i},w=function(e){var t,r,o,a,l;switch(t=function(e){return u+y/2+(i-y-2*u)/(O.objectCount-1)*e},l=d*(e.row+2/3),e.direction){case"self":return r=t(e.fromObjectIndex),CanvasHelper.drawSelfArrow(b,r,l-3*d/8,l+3*d/8,n,P,p,S,e.text,e.isDashed);case"right":return o=t(e.fromObjectIndex),a=t(e.toObjectIndex),CanvasHelper.drawRightArrow(b,o,a,l,n,P,p,S,e.text,e.isDashed);case"left":return o=t(e.toObjectIndex),a=t(e.fromObjectIndex),CanvasHelper.drawLeftArrow(b,o,a,l,n,P,p,S,e.text,e.isDashed)}},e}(),CanvasHelper=function(){function e(){}var t,n,r;return r=8,t=12,n=8,e.drawRect=function(e,t,n,r,i,o){return e.fillStyle=o,e.fillRect(t,n,r,i)},e.drawRoundedRect=function(e,t,n,r,i,o,a,l){return t+=.5,n+=.5,e.beginPath(),e.arc(t+l,n+l,l,Math.PI,1.5*Math.PI),e.lineTo(t+r-2*l,n),e.arc(t+r-l,n+l,l,1.5*Math.PI,2*Math.PI),e.lineTo(t+r,n+i-l),e.arc(t+r-l,n+i-l,l,0,.5*Math.PI),e.lineTo(t+l,n+i),e.arc(t+l,n+i-l,l,.5*Math.PI,Math.PI),e.lineTo(t,n+l),e.closePath(),e.fillStyle=o,e.fill(),e.lineWidth=1,e.strokeStyle=a,e.stroke()},e.drawRightArrow=function(e,i,o,a,l,s,c,u,f,d){return e.setLineDash(d?[n,n]:[1,0]),i=i+t-r/2,o=o-t+r/2,e.beginPath(),e.moveTo(o-n,a),e.lineTo(i,a),e.lineDashOffset=n/3,e.strokeStyle=l,e.lineWidth=n,e.stroke(),e.setLineDash([1,0]),e.beginPath(),e.moveTo(o-n,a-n),e.lineTo(o,a),e.lineTo(o-n,a+n),e.closePath(),e.fillStyle=l,e.fill(),e.fillStyle="#fff",e.fillRect(i,a-1.8*n-s,o-i-n,2.8*n),this.drawWrapText(e,f,(i+o)/2,a-s,o-i-s,"normal",s,c,u,"center",!0)},e.drawLeftArrow=function(e,i,o,a,l,s,c,u,f,d){return e.setLineDash(d?[n,n]:[1,0]),i=i+t-r/2,o=o-t+r/2,e.beginPath(),e.moveTo(i+n,a),e.lineTo(o,a),e.lineDashOffset=n/3,e.strokeStyle=l,e.lineWidth=n,e.stroke(),e.setLineDash([1,0]),e.beginPath(),e.lineTo(i+n,a-n),e.lineTo(i,a),e.lineTo(i+n,a+n),e.closePath(),e.fillStyle=l,e.fill(),e.fillStyle="#fff",e.fillRect(i+n,a-1.8*n-s,o-i-n,2.8*n),this.drawWrapText(e,f,(i+o)/2,a-s,o-i-s,"normal",s,c,u,"center",!0)},e.drawSelfArrow=function(e,i,o,a,l,s,c,u,f,d){var h;return e.setLineDash(d?[n,n]:[1,0]),i=i+t-r/2,o+=n/2,a-=n/2,h=(a-o)/2,e.beginPath(),e.moveTo(i,o),e.lineTo(i+n,o),e.arc(i+n,o+h,h,1.5*Math.PI,.5*Math.PI,!1),e.lineDashOffset=2,e.strokeStyle=l,e.lineWidth=n,e.stroke(),e.setLineDash([1,0]),e.beginPath(),e.lineTo(i+n,a-n),e.lineTo(i,a),e.lineTo(i+n,a+n),e.closePath(),e.fillStyle=l,e.fill(),this.drawWrapText(e,f,i+2*n+h,(o+a)/2+s/2,200-s,"normal",s,c,u,"left")},e.drawLifeline=function(e,t,n,i,o,a){var l;return l=e.createLinearGradient(0,0,0,i),l.addColorStop(0,o),l.addColorStop(1,a),e.beginPath(),e.moveTo(t,n+i),e.lineTo(t,n),e.setLineDash([2*r,r]),e.strokeStyle=l,e.lineWidth=r,e.stroke(),e.setLineDash([1,0])},e.drawActivation=function(e,n,r,i,o,a,l){var s;return s=e.createLinearGradient(0,0,0,o),s.addColorStop(0,a),s.addColorStop(1,l),e.beginPath(),e.moveTo(n,r+i),e.lineTo(n,r),e.strokeStyle=s,e.lineWidth=t,e.stroke()},e.drawWrapText=function(e,t,n,r,i,o,a,l,s,c){var u,f,d,h,v,b,g,w,m;for(e.font=""+o+" "+a+"px "+s,e.textAlign=c?c:"center",e.fillStyle=l,n+=1*a/3,b=t.split(" "),f="",g=0,d=1.2*a,u=w=0,m=b.length;m>=0?m>w:w>m;u=m>=0?++w:--w)h=f+b[u]+" ",v=e.measureText(h).width,v>i&&u>0?(g=a/2,e.fillText(f,n,r-g),f=b[u]+" ",r+=d):f=h;return e.fillText(f,n,r-g)},e}(),DefinationParser=function(){function e(){}return e.getSequenceData=function(e){var t,n,r,i,o,a,l,s,c,u,f,d,h,v,b,g;for(i=function(e){return 0===e.childNodes.length?"":e.childNodes[0].nodeValue},t=function(e,t){var n;return n=v.objects[e],0===n.activations.length?n.activations.push(t):n.activations[n.activations.length-1]!==t?n.activations.push(t):void 0},d=/(.+\b)\s*(-->|->|<--|<-)\s*(.+\b)\s*:\s*(.+)\n?/gm,v={objects:{},objectCount:0,messages:[],maxRow:0},o=i(e),c=0;a=d.exec(o);)s=a[1].trim(),l=a[2].trim(),u=a[3].trim(),b=a[4].trim(),n=s===u?"self":"<"===l[0]?"left":"right",void 0===v.objects[s]&&(v.objects[s]={id:c,activations:[]},c++),void 0===v.objects[u]&&(v.objects[u]={id:c,activations:[]},c++),r=v.objects[s].id,g=v.objects[u].id,0===v.messages.length?h=1:(f=v.messages[v.messages.length-1],h=r===f.toObjectIndex&&n===f.direction&&f.direction===!1?f.row:f.row+1),t(s,h),t(u,h),v.messages.push({text:b,direction:n,fromObjectIndex:r,toObjectIndex:g,isDashed:/--/.test(l),row:h}),v.objectCount=c,v.maxRow=h;return v},e}();